'use strict';

angular.module('SenseMakingApp.services', [])
    .factory('API', function ($http) {
        var api = "http://www.johnhinkel.com/SenseMaking/api/";
        return {
            callAylien: function (docNumber) {
                return $http.get(api + "AylienCalls.php?filename=\"" + docNumber + ".txt\"").then(
                    function (response) {
                        sessionStorage.setItem('Aylien', JSON.stringify(response));
                        return JSON.parse(sessionStorage.getItem('Aylien'));
                    },
                    function (httpError) {
                        throw httpError.status + " : " + httpError.data;
                    }
                );
            },
            getDocKeywordFrequency: function (docNumber, keyword) {
                return $http.get(api + "Frequency.php?filename=\"" + docNumber + ".txt\"&keyword=\"" + keyword + "\"").then(
                    function (response) {
                        sessionStorage.setItem('docKeywordFrequency', JSON.stringify(response));
                        return JSON.parse(sessionStorage.getItem('docKeywordFrequency'));
                    },
                    function (httpError) {
                        throw httpError.status + " : " + httpError.data;
                    }
                );
            },
            getDocDates: function () {
                return $http.get(api + "dateParser.php").then(
                    function (response) {
                        sessionStorage.setItem('docDates', JSON.stringify(response));
                        return JSON.parse(sessionStorage.getItem('docDates'));;
                    },
                    function (httpError) {
                        throw httpError.status + " : " + httpError.data;
                    }
                );
            },
            getDocNumbers: function () {
                return $http.get(api + "DocNumbers.php").then(
                    function (response) {
                        sessionStorage.setItem('docNumbers', JSON.stringify(response));
                        return JSON.parse(sessionStorage.getItem('docNumbers'));
                    },
                    function (httpError) {
                        return ["1101162143775","1101162433811","1101162452451","1101162452967","1101162453655","1101162454389","1101162468967","1101162469467","1101162469951","1101162470451","1101162470951","1101162488420","1101162488967","1101162490186","1101162504873","1101162505451","1101162506170","1101162507155","1101162522889","1101162523405","1101162524451","1101162539420","1101162539889","1101162540358","1101162541092","1101162589891","1101162605515","1101162605999","1101162606483","1101162607218","1101162607702","1101162622968","1101162623703","1101162624171","1101162640781","1101162641766","1101162642891","1101162686673","1101162687439","1101162688110","1101162688970","1101162691111","1101162707205","1101162707799","1101162708267","1101162708736","1101162768659","1101162769191","1101162769956","1101162770925","1101162786926","1101162787426","1101162787910","1101162788910","1101162807895","1101162809567","1101162862771","1101162863490","1101162863959","1101162879397","1101162880756","1101162881272","1101162881756","1101162902397","1101162902913","1101162903381","1101162904116","1101162906435","1101162945882","1101162948101","1101162948851","1101162949366","1101162964241","1101162965023","1101162965507","1101162966023","1101162966523","1101162981695","1101162982195","1101162982898","1101163001554","1101163002039","1101163002539","1101163004554","1101163044539","1101163061865","1101163072805","1101163128915","1101163144775","1101163156775","1101163162978","1101163179932","1101163197619","1101163233666","1101163235119","1101163252385","1101163253588","1101163287775","1101163288338","1101163307182","1101163308494","1101163324807","1101163340400","1101163342119","1101163356500","1101163375354","1101163376276","1101163390822","1101163443760","1101163444463","1101163456898","1101163461838","1101163477635","1101163498744","1101163520244","1101163520510","1101163572132","1101163575072","1101163595600","1101163613791","1101163706824","1101163726024","1101163793559","1101163834618","1101163852029","1101163853185","1101163887201","1101163889404","1101163932216","1101163941115","1101163941116","1101163941118","1101163941120","1101163941122","1101163941124","1101163941126","1101163941128","1101163941130","1101163941133","1101163941134","1101163941136","1101163941138","1101163941140","1101163941142","1101163941144","1101163941146","1101163941148","1101163941150","1101163941152","1101163941154","1101163941156","1101163941158","1101163941160","1101163941162","1101163941164","1101163941166","1101163975356","1101163977242","1101164682719","1101234275352","1101241536631","1101242384726","1101242385523","1101242386320","1101242406226","1101242406742","1101242407492","1101242407976","1101242429898","1101242430883","1101242451711","1101242452461","1101242453320","1101242456221","1101242473945","1101242496946","1101242497446","1101242518040","1101242518821","1101242519290","1101242535666","1101242542555","1101242543258","1101242563493","1101242565571","1101242586149","1101242587149","1101242612790","1101242613821","1101242614337","1101242614806","1101242634728","1101242635978","1101242636712","1101242656634","1101242657134","1101242657853","1101242678228","1101242678947","1101242700338","1101242721291","1101242722744","1101242743650","1101242745182","1101242765510","1101242766213","1101242766682","1101242786744","1101242787244","1101242808401","1101242809166","1101242809916","1101242810619","1101242876245","1101242898417","1101242963292","1101243052340","1101243074777","1101243160012","1101243182966","1101243183934","1101243226622","1101243250482","1101243272357","1101243294357","1101243315873","1101243381717","1101243402764","1101243424483","1101243446514","1201243446501","1201243446502","1201243446503","1201243446504","1201243446505","1201243446506","1201243446507","1201243446508","1201243446611","1201243446612","1201243446613","1201243446614","1201243446615"];
                    }
                );
            },
            getDocument: function (docNumber) {
                return $http.get(api + "DocFetcher.php?filename=\"" + docNumber + ".txt\"").then(
                    function (response) {
                        sessionStorage.setItem('document', JSON.stringify(response));
                        return JSON.parse(sessionStorage.getItem('document'));
                    },
                    function (httpError) {
                        throw httpError.status + " : " + httpError.data;
                    }
                );
            }
        };
    });
